(()=>{var a={};a.id=701,a.ids=[701],a.modules={846:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4870:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},9294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},3033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},7314:(a,e,t)=>{"use strict";t.r(e),t.d(e,{patchFetch:()=>b,routeModule:()=>f,serverHooks:()=>g,workAsyncStorage:()=>q,workUnitAsyncStorage:()=>v});var o={};t.r(o),t.d(o,{POST:()=>_});var r=t(5367),i=t(9088),d=t(3807),n=t(4070),s=t(5697);async function c(a){try{let e=0,t=0,o=[];for(let r of a)try{let a=`
          INSERT INTO postura (
            data, quantidade_aves, ovos_coletados, quebrados, 
            consumo_interno, created_by
          ) VALUES (?, ?, ?, ?, ?, ?)
        `,t=(await (0,s.lk)(a,[r.data,r.quantidade_aves,r.ovos_coletados,r.quebrados||0,r.consumo_interno||0,1])).meta.last_row_id,o=`
          INSERT INTO classificacao (
            postura_id, jumbo, extra, grande, medio
          ) VALUES (?, ?, ?, ?, ?)
        `;await (0,s.lk)(o,[t,r.jumbo||0,r.extra||0,r.grande||0,r.medio||0]);let i=r.data,d=`
          SELECT id, classificacao, quantidade 
          FROM estoque 
          WHERE data = ?
        `,n=(await m(d,[i])).results,c=async(a,e)=>{if(e<=0)return;let t=n.find(e=>e.classificacao===a);if(t){let a=`
              UPDATE estoque 
              SET quantidade = quantidade + ?, updated_at = CURRENT_TIMESTAMP
              WHERE id = ?
            `;await (0,s.lk)(a,[e,t.id])}else{let t=`
              INSERT INTO estoque (data, classificacao, quantidade)
              VALUES (?, ?, ?)
            `;await (0,s.lk)(t,[i,a,e])}};await c("jumbo",r.jumbo||0),await c("extra",r.extra||0),await c("grande",r.grande||0),await c("medio",r.medio||0);let u=async(a,e)=>{if(e<=0)return;let o=`
            INSERT INTO movimentacao_estoque (
              data, tipo, origem, referencia_id, classificacao, quantidade, created_by
            ) VALUES (?, 'entrada', 'producao', ?, ?, ?, ?)
          `;await (0,s.lk)(o,[i,t,a,e,1])};await u("jumbo",r.jumbo||0),await u("extra",r.extra||0),await u("grande",r.grande||0),await u("medio",r.medio||0),e++}catch(a){t++,o.push({data:r.data,erro:a.message})}return{sucessos:e,falhas:t,erros:o}}catch(a){throw console.error("Erro na importa\xe7\xe3o de dados de postura:",a),a}}async function u(a){try{let e=0,t=0,o=[];for(let r of a)try{let a=`
          INSERT INTO clientes (
            nome, telefone, email, endereco, tipo, desde, observacoes
          ) VALUES (?, ?, ?, ?, ?, ?, ?)
        `;await (0,s.lk)(a,[r.nome,r.telefone||"",r.email||"",r.endereco||"",r.tipo||"eventual",r.desde||new Date().toISOString().split("T")[0],r.observacoes||""]),e++}catch(a){t++,o.push({nome:r.nome,erro:a.message})}return{sucessos:e,falhas:t,erros:o}}catch(a){throw console.error("Erro na importa\xe7\xe3o de clientes:",a),a}}async function l(a){try{let e=0,t=0,o=[];for(let r of a)try{let a=`
          INSERT INTO encomendas (
            cliente_id, data_pedido, data_entrega, status, 
            valor_total, forma_pagamento, created_by
          ) VALUES (?, ?, ?, ?, ?, ?, ?)
        `,t=(await (0,s.lk)(a,[r.cliente_id,r.data_pedido,r.data_entrega,r.status||"pendente",r.valor_total,r.forma_pagamento||"Dinheiro",1])).meta.last_row_id;for(let a of r.itens){let e=a.quantidade*a.valor_unitario,o=`
            INSERT INTO itens_encomenda (
              encomenda_id, classificacao, quantidade, valor_unitario, valor_total
            ) VALUES (?, ?, ?, ?, ?)
          `;await (0,s.lk)(o,[t,a.classificacao,a.quantidade,a.valor_unitario,e])}if("entregue"===r.status)for(let a of r.itens){let e=`
              UPDATE estoque
              SET quantidade = quantidade - ?, updated_at = CURRENT_TIMESTAMP
              WHERE classificacao = ? AND data = (SELECT MAX(data) FROM estoque)
            `;await (0,s.lk)(e,[a.quantidade,a.classificacao]);let o=`
              INSERT INTO movimentacao_estoque (
                data, tipo, origem, referencia_id, classificacao, quantidade, created_by
              ) VALUES (?, 'saida', 'venda', ?, ?, ?, ?)
            `;await (0,s.lk)(o,[r.data_entrega,t,a.classificacao,a.quantidade,1])}e++}catch(a){t++,o.push({cliente_id:r.cliente_id,data_pedido:r.data_pedido,erro:a.message})}return{sucessos:e,falhas:t,erros:o}}catch(a){throw console.error("Erro na importa\xe7\xe3o de encomendas:",a),a}}async function m(a,e=[]){try{let t=await p();return await t.prepare(a).bind(...e).all()}catch(a){throw console.error("Erro ao executar query:",a),a}}async function p(){let{env:a}=getCloudflareContext();return a.DB}async function _(a){try{let e;let{tipo:t,dados:o}=await a.json();if(!t||!o)return n.NextResponse.json({success:!1,error:"Tipo de importa\xe7\xe3o e dados s\xe3o obrigat\xf3rios"},{status:400});switch(t){case"postura":e=await c(o);break;case"clientes":e=await u(o);break;case"encomendas":e=await l(o);break;default:return n.NextResponse.json({success:!1,error:"Tipo de importa\xe7\xe3o inv\xe1lido"},{status:400})}return n.NextResponse.json({success:!0,data:e})}catch(a){return console.error("Erro na importa\xe7\xe3o de dados:",a),n.NextResponse.json({success:!1,error:"Erro na importa\xe7\xe3o de dados"},{status:500})}}let f=new r.AppRouteRouteModule({definition:{kind:i.RouteKind.APP_ROUTE,page:"/api/importacao/route",pathname:"/api/importacao",filename:"route",bundlePath:"app/api/importacao/route"},resolvedPagePath:"/home/ubuntu/granja_app/granja_app/src/app/api/importacao/route.ts",nextConfigOutput:"",userland:o}),{workAsyncStorage:q,workUnitAsyncStorage:v,serverHooks:g}=f;function b(){return(0,d.patchFetch)({workAsyncStorage:q,workUnitAsyncStorage:v})}},5276:()=>{},2124:()=>{},5697:(a,e,t)=>{"use strict";async function o(a=5){return[{id:1,data:"2025-04-19",quantidade_aves:128,ovos_coletados:95,quebrados:1,consumo_interno:0,jumbo:15,extra:40,grande:30,medio:10},{id:2,data:"2025-04-18",quantidade_aves:128,ovos_coletados:94,quebrados:0,consumo_interno:0,jumbo:14,extra:42,grande:28,medio:10},{id:3,data:"2025-04-17",quantidade_aves:128,ovos_coletados:87,quebrados:2,consumo_interno:0,jumbo:12,extra:38,grande:27,medio:10},{id:4,data:"2025-04-16",quantidade_aves:128,ovos_coletados:83,quebrados:1,consumo_interno:0,jumbo:10,extra:36,grande:28,medio:9},{id:5,data:"2025-04-15",quantidade_aves:128,ovos_coletados:83,quebrados:0,consumo_interno:0,jumbo:11,extra:35,grande:29,medio:8}].slice(0,a)}async function r(a=5){return[{id:1,data_pedido:"2025-04-21",data_entrega:"2025-04-25",status:"pendente",valor_total:30,cliente_nome:"Maria Silva",quantidade_total:30},{id:2,data_pedido:"2025-04-21",data_entrega:"2025-04-28",status:"confirmado",valor_total:108,cliente_nome:"Restaurante Sabor",quantidade_total:90},{id:3,data_pedido:"2025-04-20",data_entrega:"2025-04-22",status:"entregue",valor_total:72,cliente_nome:"Jo\xe3o Alves",quantidade_total:60},{id:4,data_pedido:"2025-04-19",data_entrega:"2025-04-30",status:"pendente",valor_total:144,cliente_nome:"Mercado Local",quantidade_total:120},{id:5,data_pedido:"2025-04-18",data_entrega:"2025-04-21",status:"entregue",valor_total:24,cliente_nome:"Ana Souza",quantidade_total:24}].slice(0,a)}async function i(){return[{classificacao:"jumbo",quantidade:15},{classificacao:"extra",quantidade:63},{classificacao:"grande",quantidade:45},{classificacao:"medio",quantidade:25}]}async function d(a=100){return[{id:1,nome:"Maria Silva",telefone:"(11) 98765-4321",email:"maria@email.com",tipo:"recorrente",desde:"2023-01-10",ultima_compra:"2025-04-21"},{id:2,nome:"Restaurante Sabor",telefone:"(11) 3456-7890",email:"contato@sabor.com.br",tipo:"comercial",desde:"2023-03-15",ultima_compra:"2025-04-21"},{id:3,nome:"Jo\xe3o Alves",telefone:"(11) 91234-5678",email:"joao@email.com",tipo:"recorrente",desde:"2023-05-05",ultima_compra:"2025-04-20"},{id:4,nome:"Mercado Local",telefone:"(11) 2345-6789",email:"compras@mercadolocal.com.br",tipo:"comercial",desde:"2023-06-20",ultima_compra:"2025-04-19"},{id:5,nome:"Ana Souza",telefone:"(11) 98765-1234",email:"ana@email.com",tipo:"eventual",desde:"2023-08-10",ultima_compra:"2025-04-18"}].slice(0,a)}async function n(a=10){return[{id:1,data:"2025-04-19",tipo:"entrada",origem:"producao",classificacao:"jumbo",quantidade:15,responsavel:"Administrador"},{id:2,data:"2025-04-19",tipo:"entrada",origem:"producao",classificacao:"extra",quantidade:40,responsavel:"Administrador"},{id:3,data:"2025-04-19",tipo:"entrada",origem:"producao",classificacao:"grande",quantidade:30,responsavel:"Administrador"},{id:4,data:"2025-04-19",tipo:"entrada",origem:"producao",classificacao:"medio",quantidade:10,responsavel:"Administrador"},{id:5,data:"2025-04-19",tipo:"saida",origem:"quebra",classificacao:"extra",quantidade:1,responsavel:"Administrador"},{id:6,data:"2025-04-18",tipo:"saida",origem:"venda",classificacao:"extra",quantidade:30,responsavel:"Administrador"},{id:7,data:"2025-04-18",tipo:"saida",origem:"venda",classificacao:"grande",quantidade:24,responsavel:"Administrador"}].slice(0,a)}async function s(a,e){return{total_ovos:2648,taxa_postura_media:66.7,total_quebrados:12,total_consumo:8}}async function c(a,e){return{total_jumbo:380,total_extra:1120,total_grande:850,total_medio:298}}async function u(a,e,t,o,r,i,d,n,s,c="",l=1){return{success:!0,posturaId:Math.floor(1e3*Math.random())+6}}async function l(a,e,t,o="Dinheiro",r="",i=1){return{success:!0,encomendaId:Math.floor(1e3*Math.random())+6}}async function m(a,e=1){return{success:!0}}async function p(a,e=[]){return console.log("Simula\xe7\xe3o de query:",a,e),{results:[]}}async function _(a,e=[]){return console.log("Simula\xe7\xe3o de run:",a,e),{meta:{last_row_id:Math.floor(1e3*Math.random())+1}}}t.d(e,{G:()=>u,GR:()=>c,Vr:()=>n,Wl:()=>s,ZG:()=>r,eW:()=>p,i4:()=>l,ig:()=>i,lk:()=>_,xq:()=>m,ys:()=>d,zH:()=>o})}};var e=require("../../../webpack-runtime.js");e.C(a);var t=a=>e(e.s=a),o=e.X(0,[803,654],()=>t(7314));module.exports=o})();